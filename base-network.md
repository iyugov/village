# Создание базовой сети

## Описание

* Создаётся роутер Mikrotik, служащий шлюзом с NAT между виртуальной сетью проекта и сетью базовой системы. Его адрес во внутренней сети - 10.0.0.254/24, во внешней - выдаётся DHCP-сервером в сети базовой системы, шлюз в интернет имеет адрес 192.168.1.1.

* Создаётся коммутатор для соединения основных роутеров проекта в подсеть.

* Создаётся роутер для сегмента серверов. Его адрес в общей внутренней сети - 10.0.0.1/24, в сети серверов - 10.0.1.1/24.

* Создаётся коммутатор для соединения серверов  в подсеть.

* Создаётся роутер для сегмента клиентов. Его адрес в общей внутренней сети - 10.0.0.2/24, в сети клиентов - 172.16.0.1/16.

## Требования

* [Старт проекта](start.md)

## Выполнение

### Создание роутера - шлюза

1. Создадим в GNS3 роутер Mikrotik RB450G, используя данные с сервера, по последней доступной версии прошивки, с именем "Gateway".

2. Соединим порт `ether1` роутера с облаком "ISP".

3. Проведём настройку роутера:

    1) Установим пароль администратора (по умолчанию он пустой).

    2) Включим интерфейс `ether1`:

        ```mikrotik
        interface enable ether1
        ```

    3) Проверим статус DHCP-клиента:

        ```mikrotik
        ip dhcp-client print
        ```

        На интерфейсе `ether1` должен работать DHCP-клиент. Если это не так, то включим его:  

        ```mikrotik
        ip dhcp-client add interface=ether1 use-peer-dns=yes add-default-route=yes
        ```

    4) Включим интерфейс `ether2`:

        ```mikrotik
        interface enable ether2
        ```

    5) Добавим маршрут через шлюз базовой системы:

        ```mikrotik
        ip route add gateway=192.168.1.1
        ```

    6) Добавим статический IP-адрес 10.0.0.254/24 на интерфейсе `ether2`:

        ```mikrotik
        ip address add address=10.0.0.254/24 interface=ether2
        ```

    7) Включим NAT из одной сети в другую:

        ```mikrotik
        ip firewall nat add chain=srcnat out-interface=ether1 action=masquerade
        ```

    8) Проверим таблицу маршрутизации:

        ```mikrotik
        ip route print
        ```

    9) Проверим статус NAT:

        ```mikrotik
        ip firewall net print
        ```

### Создание коммутатора базовой сети

1. Создадим в GNS3 коммутатор ("Ethernet switch") с именем "GatewaySwitch".

2. Соединим порт `Ethernet0` этого коммутатора с портом `ether2` роутера "Gateway".

### Создание роутера сегмента серверов

1. Создадим в GNS3 роутер Mikrotik RB450G, используя данные с сервера, по последней доступной версии прошивки, с именем "ServersRouter".

2. Соединим порт `ether1` этого роутера с портом `Ethernet1` коммутатора "GatewaySwitch".

3. Проведём настройку роутера:

    1) Установим пароль администратора (по умолчанию он пустой).
    2) Включим интерфейс `ether1`:

        ```mikrotik
        interface enable ether1
        ```

    3) Добавим статический IP-адрес 10.0.0.1/24 на интерфейсе `ether1`:

        ```mikrotik
        ip address add address=10.0.0.1/24 interface=ether1
        ```

    4) Проверим доступность роутера "Gateway":

        ```mikrotik
        ping 10.0.0.254
        ```

        Прервать проверку можно по `Ctrl`+`c`.  

    5) Включим интерфейс `ether2`:

        ```mikrotik
        interface enable ether2
        ```

    6) Добавим маршрут через роутер "Gateway":

        ```mikrotik
        ip route add gateway=10.0.0.254
        ```

    7) Добавим статический IP-адрес 10.0.1.1/24 на интерфейсе `ether2`:

        ```mikrotik
        ip address add address=10.0.1.1/24 interface=ether2
        ```

    8) Проверим таблицу маршрутизации:

        ```mikrotik
        ip route print
        ```

4. На роутере "Gateway" добавим маршрут в сеть серверов 10.0.1.0/24 через роутер "ServerRouter":

    ```mikrotik
    ip route add dst-address=10.0.1.0/24 gateway=10.0.0.1
    ```

### Создание коммутатора сегмента серверов

1. Создадим в GNS3 коммутатор ("Ethernet switch") с именем "ServerSwitch".

2. Соединим порт `Ethernet0` этого коммутатора с портом `ether2` роутера "ServerRouter".

### Создание роутера сегмента клиентов

1. Создадим в GNS3 роутер Mikrotik RB450G, используя данные с сервера, по последней доступной версии прошивки, с именем "ServerRouter".
2. Соединим порт `ether1` этого роутера с портом `Ethernet1` коммутатора "GatewaySwitch".
3. Проведём настройку роутера:

    1) Установим пароль администратора (по умолчанию он пустой).
    2) Включим интерфейс `ether1`:

        ```mikrotik
        interface enable ether1
        ```

    3) Добавим статический IP-адрес 10.0.0.1/24 на интерфейсе `ether1`:

        ```mikrotik
        ip address add address=10.0.0.1/24 interface=ether1
        ```

    4) Проверим доступность роутера "Gateway":

        ```mikrotik
        ping 10.0.0.254
        ```

        Прервать проверку можно по `Ctrl`+`c`.  

    5) Включим интерфейс `ether2`:

        ```mikrotik
        interface enable ether2
        ```

    6) Добавим маршрут через роутер "Gateway":

        ```mikrotik
        ip route add gateway=10.0.0.254
        ```

    7) Добавим статический IP-адрес 10.0.1.1/24 на интерфейсе `ether2`:

        ```mikrotik
        ip address add address=10.0.1.1/24 interface=ether2
        ```

    8) Проверим таблицу маршрутизации:

        ```mikrotik
        ip route print
        ```

4. На роутере "Gateway" добавим маршрут в сеть серверов 10.0.1.0/24 через роутер "ServerRouter":

    ```mikrotik
    ip route add dst-address=10.0.1.0/24 gateway=10.0.0.1
    ```
